<!DOCTYPE html>
<html>
<head>
    <title>Scatter Chart with D3.js</title>
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <style>
        .dot {
            fill: steelblue;
        }
        
     svg {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }
    </style>
</head>
<body>
  <h1>Scatter Chart </h1>
  <div id="chart-container" ></div>
    <!-- <svg id="chart"></svg> -->
    
		
		<input type="hidden" id="vrblId" name="vrblName" value="placeholder"
			th:value="${dataGiven}" />
	
     <script th:inline="javascript">
    
    var indicatorsList = /*[[${indicators}]]*/ [];
	var countriesList = /*[[${countries}]]*/ [];  
    console.log(indicatorsList);
	
	  const passedDataC = document.getElementById('vrblId').value; 
      console.log("passedDataC:", passedDataC);
      /* const data = JSON.parse(passedDataC); */
      /* var passedDataC = '[{"x": "2000", "y": 100}, {"x": "2010", "y": 110},{"x": "2020", "y": 120}]'; */
      var parsedData = JSON.parse(passedDataC);
      console.log("parsedData:", parsedData);
      
      /* const data = [];
      for (let i = 0; i < parsedData.length; i++) {
    	  data.push(JSON.parse(parsedData[i]));
      }  */
      data = parsedData;
      console.log("data:", data);
      
      var bottom = 50;
   // Set up the dimensions and margins for the chart
      const margin = { top: 50, right: 50, bottom: 50, left: 50 };
      const width = 600;
      const height = 400;
      const innerWidth = width - margin.left - margin.right;
      const innerHeight = height - margin.top - margin.bottom;
	
      var colorScale = d3.scaleOrdinal(d3.schemeCategory10);

   // Create the SVG element
   var svg = d3.select("body")
     .append("svg")
     .attr("width", width + margin.left + margin.right)
     .attr("height", height + margin.top + margin.bottom)
     .append("g")
     .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

   // Create scales for x and y axes
   var xScale = d3.scaleLinear()
     .range([0, width])
     .domain([0, d3.max(data, function(subArray) {
       return d3.max(subArray, function(d) { return d.x; });
     })]);

   var yScale = d3.scaleLinear()
     .range([height, 0])
     .domain([0, d3.max(data, function(subArray) {
       return d3.max(subArray, function(d) { return d.y; });
     })]);

   // Create scatter plot circles
   svg.selectAll("circle")
     .data(data)
     .enter()
     .selectAll("circle")
     .data(function(d) { return d; })
     .enter()
     .append("circle")
     .attr("cx", function(d) { return xScale(d.x); })
     .attr("cy", function(d) { return yScale(d.y); })
     .attr("r", 5)
  	 .style("fill", (_, i, j) => colorScale(j));

   // Create x and y axes
   svg.append("g")
     .attr("transform", "translate(0," + height + ")")
     .call(d3.axisBottom(xScale));

   svg.append("g")
     .call(d3.axisLeft(yScale));

   // Add x and y axis labels
   svg.append("text")
     .attr("text-anchor", "end")
     .attr("x", width)
     .attr("y", height + margin.top + 20)
     .text("X-axis");

   svg.append("text")
     .attr("text-anchor", "end")
     .attr("transform", "rotate(-90)")
     .attr("y", -margin.left + 10)
     .attr("x", -margin.top)
     .text("Y-axis");

   // Add chart title
   svg.append("text")
     .attr("x", width / 2)
     .attr("y", margin.top / 2)
     .attr("text-anchor", "middle")
     .text("Scatter Chart");

	
     // Create legend
        const legend = svg
          .append("g")
          .attr("class", "legend")
    		//.attr("transform", "translate(" + width - margin.right + "," + margin.bottom + ")");
        .attr("transform", `translate(${margin.left + innerWidth / 20}, ${height - bottom+100})`);

         // Add legend items
        const legendItems = legend
          .selectAll(".legend-item")
          .data(countriesList[0])
          .enter()
          .append("g")
          .attr("class", "legend-item")
          .attr("transform", `translate(0,  20)`);

        // Add legend color rectangles
        legendItems
          .append("rect")
          .attr("width", 10)
          .attr("height", 10)
          .attr("fill", d3.schemeCategory10[0]);

        // Add legend text labels
        legendItems
          .append("text")
          .attr("x", 15)
          .attr("y", 6)
          .attr("dy", "0.35em")
  		  .text(countriesList[0]); // Display the country name
    </script>
</body>
</html>
